<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org" xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity6" lang="en"buttonSpecial>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initialscale=1.0">
    <header th:replace="~{linksDashboard}"></header> 

    <title>CorpoEventer - Панель</title>
 </head>
 <body id="Topic1">
    <header th:replace = "~{headerDashboard}" class="gridsp-1-16"></header>
    <aside class="gridsp-1-2 mrgn-rgt0-grey-frame grey-frame">
        <div class="slider-tabs">
            <button class="tab" data-target="section1">Календарь</button>
            <button class="tab" data-target="section2">События</button>
            <button class="tab" data-target="section3">Мероприятия</button>
            <button class="tab" data-target="section4" 
            th:if="${#authentication.principal.roles.?[name == 'DIRECTOR']?.size() > 0 or 
            #authentication.principal.roles.?[name == 'DEPARTMENT_MANAGER']?.size() > 0 or
            #authentication.principal.roles.?[name == 'SUBDEPARTMENT_MANAGER']?.size() > 0}">
                Создание событий и мероприятий
            </button>
            <button class="tab" data-target="section5" 
            th:if="${#authentication.principal.roles.?[name == 'DIRECTOR']?.size() > 0 or 
            #authentication.principal.roles.?[name == 'DEPARTMENT_MANAGER']?.size() > 0 or
            #authentication.principal.roles.?[name == 'SUBDEPARTMENT_MANAGER']?.size() > 0}">
                Управление структурой
            </button>
        </div>
    </aside>
    <main class="flex1 gridsp-3-13">
        <article class="slider-content flex1">
            <section class="content flex1 grey-frame" id="section1">
                <div id="calendar">
                    <div class="header">
                      <button id="prev">←</button>
                      <h1 id="month-year"></h1>
                      <button id="next">→</button>
                    </div>
                    <div class="weekdays">
                      <div>Понедельник</div>
                      <div>Вторник</div>
                      <div>Среда</div>
                      <div>Четверг</div>
                      <div>Пятница</div>
                      <div>Суббота</div>
                      <div>Воскресенье</div>
                    </div>
                    <div id="days" class="days"></div>
                  </div>
            </section>
            <section class="content grey-frame" id="section2">
                <h2>Текущие события</h2>
                <div class="current-events">
                </div>
                <div class="past-events">
                </div>
            </section>
            <section class="content grey-frame" id="section3">
                <h2>Текущие встречи</h2>
                <div class="current-meetings">
                </div>
        
                <div class="past-meetings">
                </div>
            </section>
            
            <section class="content grey-frame" id="section4" 
            th:if="${#authentication.principal.roles.?[name == 'DIRECTOR']?.size() > 0 or 
            #authentication.principal.roles.?[name == 'DEPARTMENT_MANAGER']?.size() > 0 or
            #authentication.principal.roles.?[name == 'SUBDEPARTMENT_MANAGER']?.size() > 0}">
                <div class="event-creation-container">
                    <div class="section-header">
                        <h2>Создание событий и мероприятий</h2>
                        <p class="section-description">Создавайте события и мероприятия для сотрудников</p>
                    </div>

                    <div class="forms-container">
                        <div class="create-event-block">
                            <h3>Создание события</h3>
                            <form id="createEventForm" class="event-form">
                                <div class="form-group">
                                    <label for="eventTitle">Название события:</label>
                                    <input type="text" id="eventTitle" name="eventTitle" required class="form-input">
                                </div>

                                <div class="form-group">
                                    <label for="eventDescription">Описание:</label>
                                    <textarea id="eventDescription" name="eventDescription" class="form-input"></textarea>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="eventStartTime">Начало:</label>
                                        <input type="datetime-local" id="eventStartTime" name="eventStartTime" required class="form-input">
                                    </div>
                                    <div class="form-group">
                                        <label for="eventEndTime">Окончание:</label>
                                        <input type="datetime-local" id="eventEndTime" name="eventEndTime" required class="form-input">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="eventLocation">Место проведения:</label>
                                    <input type="text" id="eventLocation" name="eventLocation" required class="form-input">
                                </div>

                                <div class="form-group">
                                    <label>Отправить:</label>
                                    <button type="button" class="btn-select-recipients" data-form-type="event">
                                        <i class="fas fa-building"></i> Выбрать получателей
                                    </button>
                                    <div class="selected-recipients-container">
                                        <!-- Здесь будут отображаться выбранные отделы/подотделы -->
                                    </div>
                                </div>

                                <div class="form-actions">
                                    <button type="submit" class="btn-primary">
                                        <i class="fas fa-plus"></i> Создать событие
                                    </button>
                                </div>
                            </form>
                        </div>

                        <div class="create-meeting-block">
                            <h3>Создание мероприятия</h3>
                            <form id="createMeetingForm" class="meeting-form">
                                <div class="form-group">
                                    <label for="meetingTopic">Тема:</label>
                                    <input type="text" id="meetingTopic" name="meetingTopic" required class="form-input">
                                </div>

                                <div class="form-group">
                                    <label for="meetingAgenda">Повестка:</label>
                                    <textarea id="meetingAgenda" name="meetingAgenda" class="form-input"></textarea>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="meetingStartTime">Начало:</label>
                                        <input type="datetime-local" id="meetingStartTime" name="meetingStartTime" required class="form-input">
                                    </div>
                                    <div class="form-group">
                                        <label for="meetingEndTime">Окончание:</label>
                                        <input type="datetime-local" id="meetingEndTime" name="meetingEndTime" required class="form-input">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Получатели:</label>
                                    <button type="button" class="btn-select-recipients" data-form-type="event">
                                        <i class="fas fa-users"></i> Выбрать получателей
                                    </button>
                                    <div class="selected-recipients-container">
                                    </div>
                                </div>

                                <div class="form-actions">
                                    <button type="submit" class="btn-primary">
                                        <i class="fas fa-plus"></i> Создать мероприятие
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </section>
            <section class="content grey-frame" id="section5" 
            th:if="${#authentication.principal.roles.?[name == 'DIRECTOR']?.size() > 0 or 
            #authentication.principal.roles.?[name == 'DEPARTMENT_MANAGER']?.size() > 0 or
            #authentication.principal.roles.?[name == 'SUBDEPARTMENT_MANAGER']?.size() > 0}">
                <div class="department-management">
                    <div class="section-header">
                        <h2>Управление структурой компании</h2>
                        <p class="section-description">Создавайте отделы и назначайте руководителей</p>
                    </div>
            
                    <div class="management-container">
                        <div class="create-department-block"
                        th:if="${#authentication.principal.roles.?[name == 'DIRECTOR']?.size() > 0}">
                            <h3>Создание нового отдела</h3>
                            <form id="createDepartmentForm" class="department-form">
                                <div class="form-group">
                                    <label for="departmentName">Название отдела:</label>
                                    <input type="text" id="departmentName" name="departmentName" placeholder="Введите название отдела" required class="form-input">
                                </div>
                                
                                <div class="form-group">
                                    <label for="departmentHead">Руководитель отдела:</label>
                                    <select id="departmentHead" name="departmentHead" required class="form-select">
                                        <option value="">Выберите руководителя</option>
                                    </select>
                                </div>
                    
                                <div class="form-actions">
                                    <button type="submit" class="btn-primary">
                                        <i class="fas fa-plus"></i> Создать отдел
                                    </button>
                                </div>
                            </form>
                        </div>
            
                        <div class="departments-list-block"
                        th:if="${#authentication.principal.roles.?[name == 'DIRECTOR']?.size() > 0}">
                            <div class="block-header">
                                <h3>Существующие отделы</h3>
                                <p class="block-description">Список всех отделов компании и их руководителей</p>
                            </div>
                            <div class="departments-container">
                            </div>
                        </div>
                        <div class="create-subdepartment-block" style="display: none;"
                        th:if="${#authentication.principal.roles.?[name == 'DIRECTOR']?.size() > 0 or 
                                #authentication.principal.roles.?[name == 'DEPARTMENT_MANAGER']?.size() > 0}">
                            <div class="form-container">
                                <h3>Создание подотдела</h3>
                                <form id="createSubDepartmentForm" class="department-form">
                                    <div class="form-group">
                                        <label for="subdepartmentName">Название подотдела:</label>
                                        <input type="text" id="subdepartmentName" name="subdepartmentName" 
                                               placeholder="Введите название подотдела" required class="form-input">
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="subDepartmentHead">Руководитель подотдела:</label>
                                        <select id="subDepartmentHead" name="subDepartmentHead" required class="form-select">
                                            <option value="">Выберите руководителя</option>
                                        </select>
                                    </div>
                        
                                    <div class="form-actions">
                                        <button type="submit" class="btn-primary">
                                            <i class="fas fa-plus"></i> Создать подотдел
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                        
                        <div class="subdepartments-list-block" style="display: none;"
                        th:if="${#authentication.principal.roles.?[name == 'DIRECTOR']?.size() > 0 or 
                                #authentication.principal.roles.?[name == 'DEPARTMENT_MANAGER']?.size() > 0}">
                            <div class="block-header">
                                <h3>Подотделы</h3>
                                <p class="block-description">Список всех подотделов и их руководителей</p>
                            </div>
                            <div class="subdepartments-container"></div>
                        </div>
                        
                        <div class="department-employees-block" style="display: none;"
                        th:if="${#authentication.principal.roles.?[name == 'DIRECTOR']?.size() > 0 or 
                                #authentication.principal.roles.?[name == 'DEPARTMENT_MANAGER']?.size() > 0}">
                            <div class="block-header">
                                <h3>Управление сотрудниками отдела</h3>
                                <p class="block-description">Назначайте и перемещайте сотрудников между отделами</p>
                            </div>
                            
                            <div class="employees-management">
                                <div class="employees-header">
                                    <div class="employees-title">Сотрудники отдела</div>
                                    <button class="btn-primary add-employees" id="addDepartmentEmployees">
                                        <i class="fas fa-user-plus"></i> Добавить сотрудников
                                    </button>
                                </div>
                                
                                <div class="employee-drag-area" id="departmentEmployeesList">
                                </div>
                            </div>
                        </div>

                        <div class="subdepartment-employees-block" style="display: none;"
                        th:if="${#authentication.principal.roles.?[name == 'DIRECTOR']?.size() > 0 or 
                                #authentication.principal.roles.?[name == 'DEPARTMENT_MANAGER']?.size() > 0 or
                                #authentication.principal.roles.?[name == 'SUBDEPARTMENT_MANAGER']?.size() > 0}">
                            <div class="block-header">
                                <h3>Управление сотрудниками подотдела</h3>
                                <p class="block-description">Управляйте составом подотдела</p>
                            </div>
                            
                            <div class="employees-management">
                                <div class="employees-header">
                                    <div class="employees-title">Сотрудники подотдела</div>
                                    <button class="btn-primary add-employees" id="addSubdepartmentEmployees">
                                        <i class="fas fa-user-plus"></i> Добавить сотрудников
                                    </button>
                                </div>
                                
                                <div class="employee-drag-area" id="subdepartmentEmployeesList">
                                </div>
                            </div>
                        </div>
                    </div>


                    
                </div>
            </section>
        </article>
    </main>
    <aside class="gridsp-16-3 mrgn-lft0-grey-frame grey-frame">
        <h2>Панель уведомлений</h2>
        <div id="notifications-container" class="notification-container">
        </div>
    </aside>

    <div id="modalWindow" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"></h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
            </div>
        </div>
    </div>

    <div id="employeesModal" class="modal employees-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Добавление сотрудников</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <input type="text" class="employee-search" placeholder="Поиск сотрудников...">
                <div class="employees-list">
                </div>
            </div>
        </div>
    </div>

    <div id="recipientsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Добавление получателей</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <input type="text" id="recipientSearch" class="search-input" placeholder="Поиск получателей...">
                <div class="recipients-list">
                </div>
            </div>
        </div>
    </div>

 </body>
 <script type="module" src="/java/departmentManager.js"></script>
 <script type="module" src="/java/subDepartmentManager.js"></script>
 <script src="/java/dashboardOperator.js"></script>
 <script src="/java/headerSlider.js"></script>
 <script type="module" src="/java/searchInSelection.js"></script>
 <script type="module">
    import EmployeeManager from '/java/employeeManager.js';
    const employeeManager = new EmployeeManager();
    window.employeeManager = employeeManager;
</script>
<script th:inline="javascript">
    window.userRoles = /*[[${#authentication.principal.roles.![name]}]]*/ [];
</script>
<script type="module" src="/java/eventManager.js"></script>
<script src="/java/currentUserEvents.js"></script>
<script src="/java/currentUserMeetings.js"></script>
<script src="/java/calendar.js"></script>
</html>